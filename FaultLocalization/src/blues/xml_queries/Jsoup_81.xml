<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Jsoup_81" link="https://github.com/jhy/jsoup/issues/1009">
<buginformation>
<summary>failure  guess  correct  xhtml  encoding  even  when  explicitly  declared</summary>
<description>edited string encoding iso 8859 input stream soup new byte array input stream xml version encoding encoding doctype html public dtd xhtml strict http www org xhtml dtd xhtml strict dtd html xmlns http www org 1999 xhtml lang xml lang hell örld html get bytes encoding system out println jsoup parse soup null prints xml version encoding iso 8859 doctype html public dtd xhtml strict http www org xhtml dtd xhtml strict dtd html xmlns http www org 1999 xhtml lang xml lang head head body hell rld body html instead expected output xml version encoding iso 8859 doctype html public dtd xhtml strict http www org xhtml dtd xhtml strict dtd html xmlns http www org 1999 xhtml lang xml lang head head body hell örld body html the text was updated successfully but these errors were encountered copy link contributor krystiangorecki commented jan 2018 edited use system out println jsoup parse soup null parser xml parser only explicitly declaring xml parser checking for encoding works found charset null doc child node size doc child node instanceof xml declaration xml declaration prolog xml declaration doc child node prolog name equals xml found charset prolog attr encoding without that doc child node not recognized instanceof xml declaration copy link author hans brende commented jan 2018 edited krystiangorecki this still unexpected behavior imo the html parser should minimum able deduce the encoding xhtml document when explicitly declared are parsing soup from the web which may may not xhtml format the html parser already smart enough parse the xml declaration bogus comment wouldn hard then make use the readily available encoding attribute copy link author hans brende commented jan 2018 this the workaround implemented just case anyone else needs quick solution this problem public document parse input stream input string encoding string base uri throws exception workaround for jsoup issue 1009 encoding null int input read while character whitespace int capacity 256 byte bytes new byte capacity int length bytes length byte input read bytes length byte input read while length capacity capacity bytes arrays copy bytes capacity bytes length byte length bytes length string decl new string bytes length document doc jsoup parse decl base uri parser xml parser for element doc children xml equals ignore case tag name string enc attr encoding enc null enc empty encoding enc break break input read input new sequence input stream new byte array input stream bytes length input return jsoup parse input encoding base uri copy link author hans brende commented feb 2018 fyi implemented the above workaround any since this issue was causing one our tests fail when changed the default html parser jsoup jhy added this the milestone apr 2018 jhy added the improvement label apr 2018 jhy closed this 38dfd apr 2018 copy link owner jhy commented apr 2018 thanks fixed sign for free join this conversation git hub already have account sign comment assignees one assigned labels improvement projects none yet milestone linked pull requests successfully merging pull request may close this issue none yet participants</description>
</buginformation>
<fixedfiles>
<file>org.jsoup.helper.DataUtil</file>
</fixedfiles>
</bug>
</bugrepository>
