<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Csv_16" link="https://issues.apache.org/jira/browse/CSV-224">
<buginformation>
<summary>some  multi  iterator  parsing  peek  sequences  incorrectly  consume  elements</summary>
<description>repeated  calls  csvparser  iterable  return  new  iterators  that  each  reference  the  same  underlying  parser  lexer  within  the  scope  single  iterator  row  peeking  with  iterator  hasnext  works  intended  when  row  peeking  with  iterator  hasnext  under  circumstances  that  create  new  iterator  element  consumed  the  iterator  which  cannot  accessed  subsequent  newly  created  iterators  and  iterator  next  effectively  the  record  iterator  and  the  lexer  get  out  sequence  see  snippet  below  the  right  thing  keeping  the  iterator  sequence  with  the  lexer  and  since  this  reading  from  buffer  there  seem  only  two  resolutions  one  lexer  one  iterator  new  iterators  but  peeking  with  hasnext  doesn  advance  the  lexer  there  consensus  one  these  can  put  test  public  void  newiteratorsamelexer  throws  exception  string  fiverows  system  out  println  enhanced  for  loop  peeking  csvparser  parser  new  csvparser  new  bufferedreader  new  stringreader  fiverows  csvformat  default  int  recordnumber  for  csvrecord  record  parser  recordnumber  system  out  println  recordnumber  record  get  recordnumber  break  csvparser  iterator  returns  new  iterator  but  the  lexer  isn  reset  can  pick  where  left  off  for  csvrecord  record  parser  recordnumber  system  out  println  recordnumber  record  get  enhanced  for  loop  peeking  system  out  println  nenhanced  for  loop  with  peek  parser  new  csvparser  new  bufferedreader  new  stringreader  fiverows  csvformat  default  recordnumber  for  csvrecord  record  parser  recordnumber  system  out  println  recordnumber  record  get  recordnumber  break  csvparser  iterator  returns  new  iterator  but  call  hasnext  before  next  queue  one  element  for  consumption  this  element  discarded  the  new  iterator  even  though  the  lexer  has  advanced  row  consumed  element  with  the  peek  system  out  println  hasnext  parser  iterator  hasnext  for  csvrecord  record  parser  recordnumber  system  out  println  recordnumber  record  get  enhanced  for  loop  with  peek  hasnext  true  system  out  println  niterator  while  with  peek  parser  new  csvparser  new  bufferedreader  new  stringreader  fiverows  csvformat  default  recordnumber  iterator  csvrecord  iter  parser  iterator  while  iter  hasnext  csvrecord  record  iter  next  recordnumber  system  out  println  recordnumber  record  get  recordnumber  break  when  use  the  same  iterator  iterator  and  lexer  are  sequence  system  out  println  hasnext  iter  hasnext  while  iter  hasnext  csvrecord  record  iter  next  recordnumber  system  out  println  recordnumber  record  get  iterator  while  with  peek  hasnext  true</description>
</buginformation>
<fixedfiles>
<file>org.apache.commons.csv.CSVParser</file>
</fixedfiles>
</bug>
</bugrepository>
