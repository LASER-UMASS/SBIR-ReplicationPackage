<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Jsoup_30" link="https://github.com/jhy/jsoup/issues/246">
<buginformation>
<summary>jsoup  clean  sometimes  will  throw  execution  exception  java  lang stack overflow error</summary>
<description>error throw execution exception java lang stack overflow error java util concurrent execution exception java lang stack overflow error caused java lang stack overflow error org jsoup safety whitelist safe tag whitelist java 323 org jsoup safety cleaner copy safe nodes cleaner java 115 org jsoup safety cleaner copy safe nodes cleaner java 127 org jsoup safety cleaner copy safe nodes cleaner java 127 org jsoup safety cleaner copy safe nodes cleaner java 127 org jsoup safety cleaner copy safe nodes cleaner java 127 clean the url http blog sina com blog 501a 0102dx html have much wbr tags when search the page source found 24205 look org jsoup safety cleaner source code and add code like this private int num iterates the input and copies trusted nodes tags attributes text into the destination param source source html param dest destination element copy into return number discarded elements that were considered unsafe private int copy safe nodes element source element dest list node source children source child nodes int num discarded for node source child source children num logger info num num 2000 break this tag break source child instanceof element element source element source child whitelist safe tag source tag name safe clone and copy safe attrs element meta meta create safe element source element dest child meta dest append child dest child num discarded meta num attribs discarded num discarded copy safe nodes source dest child recurs else not safe tag but may have children els text that are recurse num discarded num discarded copy safe nodes source dest else source child instanceof text node text node source text text node source child text node dest text new text node source text get whole text source child base uri dest append child dest text else don care about comments xml proc instructions etc return num discarded but the clean result will wrong and the layout will chaos how can solve this problem the text was updated successfully but these errors were encountered copy link owner jhy commented sep 2012 what version jsoup are you running what your stack size set tried using jsoup with extremely low stack xss 128 and the clean runs correctly with exceptions any lower 100 and get initialization errors there were some good memory improvements between and upgrading may help also you might like try increasing your stack size the problem here running out stack while recursively copying nodes down the tree will look modifying the routine use traverser rather than recurse function which will prevent recursing deep that one gets stack overflow jhy closed this dfac 9ce sep 2012 sign for free join this conversation git hub already have account sign comment assignees one assigned labels none yet projects none yet milestone milestone linked pull requests successfully merging pull request may close this issue none yet participants</description>
</buginformation>
<fixedfiles>
<file>org.jsoup.safety.Cleaner</file>
</fixedfiles>
</bug>
</bugrepository>
