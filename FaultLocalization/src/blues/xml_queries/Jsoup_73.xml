<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Jsoup_73" link="https://github.com/jhy/jsoup/issues/977">
<buginformation>
<summary>dom  siblings  are  incorrectly  inheriting  namespaces</summary>
<description>not sure this bug missing something that defined specification when parsing dom html file without namespace that have some element with defined namespace elements that are following will inherit that namespace small test case and test html are included test zip the text was updated successfully but these errors were encountered copy link owner jhy commented nov 2017 could you please inline the test case and example html will make more accessible for people review copy link author cigaly commented nov 2017 here they are html doctype html html lang head title title title head body role document picture class header image img sizes 100vw alt srcset http example com small header jpg 480w http example com mid header jpg 1024w http example com large header jpg 1980w width 100 src http example com large header jpg picture svg version class logo gocomics 2016 xmlns http www org 2000 svg path 437 456 437 path svg picture class footer image img sizes 100vw alt srcset http example com small footer jpg 480w http example com mid footer jpg 1024w http example com large footer jpg 1980w width 100 src http example com large footer jpg picture body html and test test public void another namespace preservation throws exception file parse test get file htmltests html org jsoup nodes document jsoup doc jsoup doc jsoup parse utf document doc dom dom new dom doc dom from jsoup jsoup doc node html doc get child nodes item assert null html get namespace uri assert equals html html get local name assert equals html html get node name final node list child nodes html get child nodes final node head node child nodes item final node body node child nodes item final node list body child nodes body node get child nodes list org dom element elements new array list for int index index body child nodes get length index final node item body child nodes item index item instanceof org dom element elements add org dom element item assert equals elements size final org dom element first picture elements get assert null first picture get namespace uri assert equals picture first picture get local name assert equals picture first picture get node name final org dom element svg elements get assert equals http www org 2000 svg svg get namespace uri assert equals svg svg get local name assert equals svg svg get node name final org dom element second picture elements get assert null second picture get namespace uri assert equals picture second picture get local name assert equals picture second picture get node name copy link owner jhy commented nov 2017 thanks bug path should the svg namespace because the svg element sets default namespace for child elements but picture sibling not child should inherit the default empty namespace jhy added the bug label nov 2017 jhy changed the title possiblbe problem with namespace handling dom siblings are incorrectly inheriting namespaces nov 2017 copy link author cigaly commented nov 2017 very quick and probably very dirty solution have stack namespaces with push builder head and pop builder tail this way all test will pass including this one something like this diff git src main java org jsoup helper dom java src main java org jsoup helper dom java index 71e 6df 28ec 100644 src main java org jsoup helper dom java src main java org jsoup helper dom java import javax xml transform dom dom source import javax xml transform stream stream result import java string writer import java util hash map import java util stack helper class transform link org jsoup nodes document link org dom document org dom document public class dom private static final string xmlns prefix xmlns private final document doc private final hash map string string namespaces new hash map prefix urn private final stack hash map string string namespaces stack new stack prefix urn private element dest public builder document doc this doc doc this namespaces stack push new hash map string string public void head org jsoup nodes node source int depth namespaces stack push new hash map namespaces stack peek source instanceof org jsoup nodes element org jsoup nodes element source org jsoup nodes element source string prefix update namespaces source string namespace namespaces get prefix string namespace namespaces stack peek get prefix element doc create element namespace source tag name copy attributes source 113 116 public class dom source instanceof org jsoup nodes element dest get parent node instanceof element dest element dest get parent node undescend cromulent namespaces stack pop private void copy attributes org jsoup nodes node source element 141 145 public class dom else continue namespaces put prefix attr get value namespaces stack peek put prefix attr get value get the element prefix any jhy added this the milestone nov 2017 copy link owner jhy commented nov 2017 thanks for the patch like the approach merged jhy closed this 3475dc nov 2017 sign for free join this conversation git hub already have account sign comment assignees one assigned labels bug projects none yet milestone linked pull requests successfully merging pull request may close this issue none yet participants</description>
</buginformation>
<fixedfiles>
<file>org.jsoup.helper.W3CDom</file>
</fixedfiles>
</bug>
</bugrepository>
