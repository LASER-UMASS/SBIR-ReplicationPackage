<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Jsoup_44" link="https://github.com/jhy/jsoup/issues/552">
<buginformation>
<summary>unexpected  elements  inside  table  are  moved  wrong  location</summary>
<description>this commit 991936 introduced bug where handling unexpected elements inside table element changed resulting the unexpected elements being pushed further the document than before have constructed minimal repro before the commit question the unexpected tag would continue positioned after the comment with some elements being closed early etc support this after the commit the tag and its contents are moved more than one table level and now appear after the comment tag obviously this input html very broken and bad but seems that the change behaviour was unintended copying jaredstehler test public void test invalid table contents throws exception file get file htmltests table invalid elements html document doc jsoup parse utf doc output settings pretty print true string rendered doc string int end email rendered index comment int guarantee rendered index why here assert true comment not found end email assert true search text not found guarantee assert true search text did not come after comment guarantee end email uses the following fixture html body table table comment table why here table table body html the text was updated successfully but these errors were encountered copy link owner jhy commented apr 2015 thanks reviewed the commit and can immediately see the problem where regressed copy link contributor jaredstehler commented jun 2015 the issue seems that the pattern boolean processed process end tag table processed return process broken with the change reuse end tags via the process end tag method that affects the tag referenced for example handle missing https github com jhy jsoup blob master src main java org jsoup parser html tree builder state java 1135 private boolean handle missing token tree builder boolean processed process end tag processed return process else return false after returning from process end tag the name property has been changed from table causing not fall into the appropriate condition during the subsequent process here https github com jhy jsoup blob master src main java org jsoup parser html tree builder state java 1052 1053 there may other places where this affecting things but this one which seems dangerous the issue seeing that the attached html parses into the following dom html head head body table tbody why here table tbody comment tbody table tbody table body html where the previous jsoup and indeed chrome browser parse into html head head body table tbody table tbody comment tbody table why here table table tbody table body html open with the aforementioned test case and more specific changes getting pass jaredstehler mentioned this issue jun 2015 issue 552 fix 591 closed jhy closed this 39c jul 2015 copy link owner jhy commented jul 2015 thanks very much for your work this zazi added commit dswarm jsoup that referenced this issue oct 2015 fixed issue where unexpected elements badly nested table coul 5015d moved the wrong location the document fixes jhy 552 closes jhy 591 sign for free join this conversation git hub already have account sign comment assignees one assigned labels none yet projects none yet milestone milestone linked pull requests successfully merging pull request may close this issue none yet participants</description>
</buginformation>
<fixedfiles>
<file>org.jsoup.parser.TreeBuilder</file>
</fixedfiles>
</bug>
</bugrepository>
