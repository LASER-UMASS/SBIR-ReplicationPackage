<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Gson_6" link="https://github.com/google/gson/pull/800">
<buginformation>
<summary>fixed  regression  gson  where  gson  caused  npe  the type adapt</summary>
<description>factory create returned null fixed regression gson where gson caused npe the type adapt 731abb factory create returned null inder 123 assigned swankjesse feb 2016 copy link collaborator author inder 123 commented feb 2016 would like cut gson with this change let know you have any concerns swankjesse and jake wharton swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java import junit framework test case public class json adapter null safe test extends test case this comment has been minimized sign view swankjesse feb 2016 collaborator any way you could write simpler test for this there lot stuff here swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java device gson from json device json device class assert not null device control data fail catch json syntax exception expected this comment has been minimized sign view swankjesse feb 2016 collaborator nit weird syntax including space indents this file this comment has been minimized sign view inder 123 feb 2016 author collaborator swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java string int category boolean always serialized name codeset int codeset this comment has been minimized sign view swankjesse feb 2016 collaborator seems like distraction from the test this comment has been minimized sign view inder 123 feb 2016 author collaborator will simplify merging device with control data swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java need write special type adapter static final class json adapter factory extends stringified json adapter factory control data private static final thread local boolean recursive call new thread local boolean this comment has been minimized sign view swankjesse feb 2016 collaborator thread local really necessary trigger this this comment has been minimized sign view inder 123 feb 2016 author collaborator yes debugged the problem realized that the constructor constructor get resulted recursive call the json adapter factory since don want infinite loop had used thread local avoid that problem gson now that thread local returning null was causing this regression copy link collaborator swankjesse commented feb 2016 fix looks reasonable but the test case looks like you just pulled from another codebase could you write targeted test case instead incorporated code review feedback simplified the code merged device 79a 00cd and control and removed unnecessary fields copy link collaborator author inder 123 commented feb 2016 done take another look swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java write the value string not json static final class json adapter factory implements type adapter factory private static final thread local boolean recursive call new thread local boolean this comment has been minimized sign view swankjesse feb 2016 collaborator does this really need recursive call reproduce weird this comment has been minimized sign view inder 123 feb 2016 author collaborator yes does because the thread local used prevent infinite recursion swankjesse reviewed feb 2016 view changes gson src test java com google gson regression json adapter null safe test java private json element parse string json parser parser string json string prev json throws exception called recursively json null json trim empty this comment has been minimized sign view swankjesse feb 2016 collaborator these cases happen tests this comment has been minimized sign view inder 123 feb 2016 author collaborator you mean the null and empty checks have removed copy link collaborator swankjesse commented feb 2016 still don really understand this test would end users use thread locals copy link collaborator author inder 123 commented feb 2016 swankjesse this production code written for specific use case was interacting with rest service that unfortunately stored json string field support that with json wrote this adapter class didn start with thread locals but the recursive invocation from json adapter factory forced hand removed unneeded null check 1fa 4382 copy link collaborator swankjesse commented feb 2016 rather than starting with the test you used trigger this your application can you build test case from scratch specifically reproduce this bug copy link collaborator swankjesse commented feb 2016 don imagine that parsing json string necessary for the fix made here copy link collaborator swankjesse commented feb 2016 erm you shouldn need convert string from json within another type adapter incorporated code review feedback eliminating the stringified type 1ab 73ff adapter copy link collaborator author inder 123 commented feb 2016 revised the test eliminate string json conversion copy link collaborator swankjesse commented feb 2016 yeah that more obvious thanks swankjesse added commit that referenced this pull request feb 2016 merge pull request 800 from google nullsafe regression bugfix dea 3055 fixed regression gson where gson caused npe the type adapt hide details view details swankjesse merged commit dea 3055 into master feb 2016 checks passed checks passed cla google all necessary are signed continuous integration travis the travis build passed details continuous integration travis push the travis build passed details inder 123 deleted the nullsafe regression bugfix branch feb 2016 sebasjm pushed commit sebasjm gson that referenced this pull request mar 2018 merge pull request google 800 from google nullsafe regression bugfix 341ab fixed regression gson where gson caused npe the type adapt sign for free join this conversation git hub already have account sign comment reviewers reviews assignees swankjesse labels none yet projects none yet milestone milestone linked issues successfully merging this pull request may close these issues none yet participants</description>
</buginformation>
<fixedfiles>
<file>com.google.gson.internal.bind.JsonAdapterAnnotationTypeAdapterFactory</file>
</fixedfiles>
</bug>
</bugrepository>
