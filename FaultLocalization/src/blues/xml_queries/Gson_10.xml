<?xml version="1.0" encoding="ISO-8859-1"?>
<bugrepository name="Defects4J">
<bug id="Gson_10" link="https://github.com/google/gson/issues/831">
<buginformation>
<summary>json adapter  annotation  ignored  for  primitive  fields</summary>
<description>edited reflective type adapter factory correctly detects the json adapter annotation and registers the custom adapter source but its write method wraps that type adapter type adapter runtime type wrapper source which overrides the adapter with the default gson adapter source here test that demonstrates the behavior diff git gson src test java com google gson functional json adapter annotation fields test java gson src test java com google gson functional json adapter annotation fields test index 745ec 8cae 980 100644 gson src test java com google gson functional json adapter annotation fields test java gson src test java com google gson functional json adapter annotation fields test java 220 220 public final class json adapter annotation fields test extends test case this part part public void test primitive field annotation takes precedence over default gson gson new gson string json gson json new gadget with primitive part assert equals part json gadget with primitive part gadget gson from json json gadget with primitive part class assert equals gadget part private static final class gadget with primitive part json adapter long string type adapter factory class final long part private gadget with primitive part long part this part part private static final class long string type adapter factory implements type adapter factory static final type adapter long adapter new type adapter long override public void write json writer out long value throws exception out value value string suppress warnings unchecked override public long read json reader throws exception return next long override public type adapter create gson gson final type token type class cls type get raw type long class assignable from cls return type adapter adapter else long class assignable from cls return type adapter adapter throw new illegal state exception non long field type type annotated with json adapter long string type adapter factory class and here the result running snip running com google gson functional json adapter annotation fields test tests run failures errors skipped time elapsed 016 sec failure snip results failed tests test primitive field annotation takes precedence over default com google gson functional json adapter annotation fields test expected part but was part tests run 990 failures errors skipped this the intended behavior json adapter documentation bit misleading not unfortunately not have suggested fix was actually bit surprised see that new type adapter runtime type wrapper object constructed for each field that serialized every serialization case you would like incorporate test into gson hereby assign copyright that test google thanks the text was updated successfully but these errors were encountered copy link contributor jake wharton commented apr 2016 looks like bug indeed tue apr 2016 brandon mintern notifications github com wrote reflective type adapter factory correctly detects the json adapter annotation and registers the custom adapter source gson gson src main java com google gson internal bind reflective type adapter factory java line 133 6af adapter null return adapter but its write method wraps that type adapter type adapter runtime type wrapper source gson gson src main java com google gson internal bind reflective type adapter factory java line 111 6af new type adapter runtime type wrapper context this type adapter field type get type which overrides the adapter with the default gson adapter source gson gson src main java com google gson internal bind type adapter runtime type wrapper java line 6af chosen runtime type adapter here test that displays the behavior diff git gson src test java com google gson functional json adapter annotation fields test java gson src test java com google gson functional json adapter annotation fields test index 745ec 8cae 980 100644 gson src test java com google gson functional json adapter annotation fields test java gson src test java com google gson functional json adapter annotation fields test java 220 220 public final class json adapter annotation fields test extends test case this part part public void test primitive field annotation takes precedence over default gson gson new gson string json gson json new gadget with primitive part assert equals part json gadget with primitive part gadget gson from json json gadget with primitive part class assert equals gadget part private static final class gadget with primitive part json adapter long string type adapter factory class final long part private gadget with primitive part long part this part part private static final class long string type adapter factory implements type adapter factory static final type adapter adapter new type adapter override public void write json writer out long value throws exception out value value string suppress warnings unchecked override public long read json reader throws exception return next long override public type adapter create gson gson final type token type class cls type get raw type long class assignable from cls return type adapter adapter else long class assignable from cls return type adapter adapter throw new illegal state exception non long field type type annotated with json adapter long string type adapter factory class and here the result running snip running com google gson functional json adapter annotation fields test tests run failures errors skipped time elapsed 016 sec failure snip results failed tests test primitive field annotation takes precedence over default com google gson functional json adapter annotation fields test expected part but was part tests run 990 failures errors skipped this the intended behavior json adapter documentation bit misleading not unfortunately not have suggested fix was actually bit surprised see that new type adapter runtime type wrapper object constructed for each field that serialized every serialization case you would like incorporate test into gson hereby assign copyright that test google thanks you are receiving this because you are subscribed this thread reply this email directly view git hub 831 inder 123 self assigned this apr 2016 copy link collaborator inder 123 commented apr 2016 fixed 832 inder 123 mentioned this issue apr 2016 ensuring that json adapter annotation works correctly for primitive 832 merged copy link author mintern commented apr 2016 that was fast fix thank you very much copy link author mintern commented apr 2016 happy for you close this you like only leaving open case you prefer close issues after merging the fix after releasing according some other policy copy link collaborator inder 123 commented apr 2016 yes prefer close issue only after the fix has been merged thanks for reporting with test reproduce mintern copy link gui commented may 2016 should this closed inder 123 closed this may 2016 copy link collaborator inder 123 commented may 2016 yes sign for free join this conversation git hub already have account sign comment assignees inder 123 labels none yet projects none yet milestone milestone linked pull requests successfully merging pull request may close this issue none yet participants</description>
</buginformation>
<fixedfiles>
<file>com.google.gson.internal.bind.ReflectiveTypeAdapterFactory</file>
</fixedfiles>
</bug>
</bugrepository>
